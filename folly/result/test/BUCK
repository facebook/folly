load("@fbcode_macros//build_defs:build_file_migration.bzl", "fbcode_target")
load("@fbcode_macros//build_defs:cpp_library.bzl", "cpp_library")
load("@fbcode_macros//build_defs:cpp_unittest.bzl", "cpp_unittest")

oncall("fbcode_entropy_wardens_folly")

fbcode_target(
    _kind = cpp_unittest,
    name = "await_result_from_task_test",
    srcs = ["await_result_from_task_test.cpp"],
    deps = [
        "//folly/coro:gtest_helpers",
        "//folly/coro:value_or_error",
        "//folly/coro/safe:now_task",
        "//folly/result:coro",
    ],
)

fbcode_target(
    _kind = cpp_library,
    name = "common",
    headers = ["common.h"],
    exported_deps = [
        "//folly:benchmark",
        "//folly/portability:gmock",
        "//folly/portability:gtest",
        "//folly/result:rich_error_base",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "immortal_rich_error_test",
    srcs = ["immortal_rich_error_test.cpp"],
    deps = [
        ":common",
        "//folly/portability:gtest",
        "//folly/result:immortal_rich_error",
        "//folly/result:rich_error",
        "//folly/result:rich_msg",
    ],
)

# Runs as a test by default, pass --benchmark=1 to run as benchmark.
fbcode_target(
    _kind = cpp_unittest,
    name = "result_coro_bench",
    srcs = ["result_coro_bench.cpp"],
    deps = [
        ":common",
        "//folly:benchmark",
        "//folly:portability",
        "//folly/lang:keep",
        "//folly/result:coro",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "result_test",
    srcs = ["result_test.cpp"],
    deps = [
        "fbsource//third-party/googletest:gtest",
        "//folly/coro:traits",
        "//folly/result:gtest_helpers",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "rich_error_test",
    srcs = ["rich_error_test.cpp"],
    deps = [
        ":common",
        "//folly/portability:gmock",
        "//folly/portability:gtest",
        "//folly/result:rich_error",
        "//folly/result:rich_error_base",
    ],
)

fbcode_target(
    _kind = cpp_library,
    name = "rich_exception_ptr_check_get",
    headers = ["rich_exception_ptr_check_get.h"],
    exported_deps = [
        ":rich_exception_ptr_common",
        "//folly/result:rich_error",
    ],
)

fbcode_target(
    _kind = cpp_library,
    name = "rich_exception_ptr_common",
    headers = ["rich_exception_ptr_common.h"],
    exported_deps = [
        "//folly/portability:gtest",
        "//folly/result:rich_error_base",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "rich_exception_ptr_constexpr_test",
    srcs = ["rich_exception_ptr_constexpr.cpp"],
    deps = [
        ":rich_exception_ptr_common",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "rich_exception_ptr_fundamentals_test",
    srcs = ["rich_exception_ptr_fundamentals_test.cpp"],
    deps = [
        ":rich_exception_ptr_common",
        "//folly/portability:gtest",
        "//folly/result:rich_error",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "rich_exception_ptr_misc_test",
    srcs = ["rich_exception_ptr_misc_test.cpp"],
    deps = [
        ":rich_exception_ptr_check_get",
        "//folly:operation_cancelled",
        "//folly/portability:gtest",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "rich_exception_ptr_owned_test",
    srcs = ["rich_exception_ptr_owned_test.cpp"],
    deps = [
        ":rich_exception_ptr_check_get",
        "//folly/portability:gtest",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "rich_msg_test",
    srcs = ["rich_msg_test.cpp"],
    deps = [
        "//folly/portability:gtest",
        "//folly/result:rich_msg",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "try_test",
    srcs = ["try_test.cpp"],
    deps = [
        "//folly/portability:gtest",
        "//folly/result:try",
    ],
)

fbcode_target(
    _kind = cpp_unittest,
    name = "value_only_result_test",
    srcs = ["value_only_result_test.cpp"],
    deps = [
        "fbsource//third-party/googletest:gtest",
        "//folly/result:gtest_helpers",
        "//folly/result:value_only_result",
    ],
)
